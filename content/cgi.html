<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Pagination Example</title>
</head>
<body>
    <h1>42 API Data Fetch with Pagination</h1>
    <div id="output"></div>
    <script>
        // Replace with your actual access token
        const accessToken = 'b1e16febec7f666a6c618823b5e6045e3b8c68fffdd2c7c234d697635f224d7e';

        // Define the initial endpoint with pagination
        let currentPage = 1;
        const endpoint = `https://api.intra.42.fr/v2/campus/51/users?page[number]=${currentPage}&page[size]=30`;

        // Function to fetch data for the current page
        function fetchData(url) {
            fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                const linkHeader = response.headers.get('Link');
                console.log("TEST    !!!!!!!!!!!!!!!!!!\n");
                console.log(linkHeader);
                if (linkHeader) {
                    const links = parseLinkHeader(linkHeader);
                    const nextPageUrl = links['next'];
                    if (nextPageUrl) {
                        // Fetch next page recursively
                        fetchData(nextPageUrl);
                    }
                }
                return response.json();
            })
            .then(data => {
                displayUserData(data);
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('output').textContent = 'Error fetching data.';
            });
        }

        // Function to parse Link HTTP header
        function parseLinkHeader(header) {
            const links = {};
            header.split(',').forEach(part => {
                const section = part.split(';');
                if (section.length !== 2) return;
                const url = section[0].replace(/<(.*)>/, '$1').trim();
                const name = section[1].replace(/rel="(.*)"/, '$1').trim();
                links[name] = url;
            });
            return links;
        }

        // Function to display user data
        function displayUserData(data) {
            const user = data.find(user => user.name === 'evan-ite');
            if (user) {
                // Display the user's data
                const outputDiv = document.getElementById('output');
                outputDiv.innerHTML = `
                    <div class="user-info">  
                        <h2>${user.usual_full_name}</h2>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Login:</strong> ${user.login}</p>
                        <p><strong>First Name:</strong> ${user.first_name}</p>
                        <p><strong>Last Name:</strong> ${user.last_name}</p>
                        <p><strong>Phone:</strong> ${user.phone}</p>
                        <p><strong>Correction Points:</strong> ${user.correction_point}</p>
                        <p><strong>Location:</strong> ${user.location}</p>
                        <p><strong>Wallet:</strong> ${user.wallet}</p>
                        <p><strong>Profile URL:</strong> <a href="${user.url}">${user.url}</a></p>
                    </div>
                `;
            } else {
                document.getElementById('output').textContent = 'User not found.';
            }
        }

        // Start fetching data
        fetchData(endpoint);
    </script>
</body>
</html>
